<aura:component controller="MonthlyReportController" implements="flexipage:availableForAllPageTypes,force:hasRecordId" description="MonthlyReportRelatedList">

    <c:common_methods aura:id="commonMethods" />

    <aura:attribute name="months" type="String[]" access="private"/>
    <aura:attribute name="years" type="String[]" access="private"/>
    <aura:attribute name="selectedMonth" type="String" access="private" />
    <aura:attribute name="selectedYear" type="String" access="private" />
    <aura:attribute name="columns" type="List" default="[{label: 'Name', fieldName: 'Name', type: 'text'}]"/>
    <aura:attribute name="filteredRecords" type="List" access="private" />
    <aura:attribute name="records" type="List" access="private" />
    <aura:attribute name="isLoading" type="Boolean" default="true" access="private" />
    <aura:attribute name="contractors" type="List" access="private" />
    <aura:attribute name="selectedContractor" type="Object" access="private" />
    <aura:attribute name="draftValues" type="Object" default="[]"/>

    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:handler event="c:GenerateMonthlyReportEvent" action="{!c.doInit}" />

    <lightning:card>
        <aura:set attribute="title">
            <lightning:icon iconName="custom:custom33" size="small"/>
            Monthly Reports ({!v.filteredRecords.length})
        </aura:set>
        <lightning:layout horizontalAlign="center" verticalAlign="end">
            <lightning:layoutItem class="slds-p-around_small">
                <lightning:select name="month" label="Select a month:" aura:id="month" value="{!v.selectedMonth}" >
                    <aura:iteration items="{!v.months}" var="month">
                        <option text="{!month.label}" value="{!month.id}" selected="{!month.label==v.selectedMonth}"/>
                    </aura:iteration>
                </lightning:select>
            </lightning:layoutItem>
            <lightning:layoutItem class="slds-p-around_small">
                <lightning:select name="year" label="Select a year:" aura:id="year" value="{!v.selectedYear}">
                    <aura:iteration items="{!v.years}" var="year">
                        <option text="{!year.label}" value="{!year.id}" selected="{!year.label==v.selectedYear}"/>
                    </aura:iteration>
                </lightning:select>
            </lightning:layoutItem>
                <lightning:layoutItem class="slds-p-around_small">
                    <lightning:select name="contractor" label="Select a contractor:" aura:id="contractor" value="{!v.selectedContractor}" title="Sorted by contractors with 'Active' Allocation alphabetically">
                        <option text="All" value="" selected="true"/>
                        <aura:iteration items="{!v.contractors}" var="contractor">
                            <option text="{!contractor.Name}" value="{!contractor.Id}" selected="{!contractor.Id==v.selectedContractor}"/>
                        </aura:iteration>
                    </lightning:select>
                </lightning:layoutItem>
            <lightning:layoutItem class="slds-p-around_small">
                <lightning:button label="Search"
                                  class="slds-m-top_xx-small"
                                  variant="brand"
                                  onclick="{!c.onFilterMonthlyReports}"/>
            </lightning:layoutItem>
        </lightning:layout>
        <aura:if isTrue="{!v.isLoading}">
            <div>
                <lightning:spinner alternativeText="Loading" size="small" />
            </div>
            <aura:set attribute="else">
                <aura:if isTrue="{!not(empty(v.filteredRecords))}" >
                    <div class="slds-scrollable_y" id="related_list">
                        <lightning:datatable keyField="Id"
                                             isLoading="{!v.isLoading}"
                                             data="{!v.filteredRecords}"
                                             columns="{!v.columns}"
                                             hideCheckboxColumn="true"
                                             onsave="{!c.onSaveDataTable}"
                                             draftValues="{! v.draftValues }"
                        />
                    </div>
                    <aura:set attribute="else">
                        <div class="slds-scrollable_y slds-align_absolute-center" id="related_list_empty_message">
                            <p>
                                No items to display.
                            </p>
                        </div>
                    </aura:set>
                </aura:if>
            </aura:set>
        </aura:if>
    </lightning:card>
</aura:component>